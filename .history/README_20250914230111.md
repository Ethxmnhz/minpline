# Minpline – Calorie & Exercise Tracker (PWA)

Mobile-first React + TypeScript single-page Progressive Web App for logging meals, tracking macros & workouts, visualizing recent trends, and saving meal templates for quick add. Local-first with optional cloud sync. Installable on Android (Add to Home Screen) and usable offline.

## Features
- Daily meals logging (calories, protein, carbs, fats)
- Workout logging (type + calories burned)
- Saved meal templates (quick add to today)
- Food search (local Indian foods dataset) + optional remote nutrition lookup (API Ninjas style)
- Goals (calories + macros) editable in Settings
- Net calorie dashboard (meals minus workout calories)
- History page: 14‑day net calorie bar chart + average macros
- Daily workout set planner (Pushups / Pull Ups / Legs) with completion tracking
- Local persistence (Zustand + versioned migrations)
- Optional Firebase anonymous cloud sync (toggle in Settings)
- PWA: offline cache + install prompt (service worker + manifest)
- Mobile-first responsive UI

## Tech Stack
- React 18 + TypeScript + Vite
- Zustand (persist + migrations)
- Firebase Realtime DB (optional sync)
- Inline SVG for lightweight charts
- Service Worker + Web App Manifest (PWA)
- date-fns (minimal date helpers)

## Development
Install dependencies and start dev server:

```bash
npm install
npm run dev
```

Open http://localhost:5173

### Environment Variables
Create a `.env` file for remote nutrition (optional):

```
VITE_NUTRITION_API_KEY=your_api_ninjas_key
```

Example (do NOT commit real keys):

```
VITE_NUTRITION_API_KEY=YOUR_API_KEY_HERE
```

If omitted, the remote nutrition section will show a message and only local dataset works.

### Firebase Cloud Sync
Anonymous auth is used. Toggle Cloud Sync in Settings. Data stored at:
`/users/<uid>/trackerData` in Firebase Realtime Database.

Sync Strategy:
- On enable: fetch remote dataset; if empty remote -> push local.
- Live subscription merges remote (overwrite preference) then local edits debounce-push (1.5s).
- Disable sync: keeps local state; no remote writes.

NOTE: Firebase config in `src/services/firebase.ts` contains public keys (safe). Do not put secrets in frontend code.

## Data Model
See `src/types.ts` for TypeScript interfaces.

Store key: `tracker-store` (versioned). Migrations sanitize workout set keys & dates.

### PWA / Offline
Service worker (`public/sw.js`) caches the app shell (index.html + icons + manifest). Navigation fallbacks work offline; cross-origin API calls are network-only.

Install (Android / Desktop Chrome): open the site, look for Install / Add to Home Screen prompt or use browser menu. Icons (192, 512) supplied in `public/icons`.

To test locally:
1. `npm run build`
2. `npm run preview`
3. Open in Chrome and audit with Lighthouse (Progressive Web App category).

### History Chart
`src/pages/History.tsx` renders last 14 days net calories (goal baseline line) with color-coded bars (green under, red over). Averages macros beneath.

### Nutrition API Optimization
To minimize external API usage and save mobile data:
- Cache-first strategy: successful nutrition lookups cached for 6 hours in persisted state (`nutritionCache`).
- Request deduplication: concurrent identical queries share a single in-flight promise.
- Soft rate limiting: minimum interval of 600ms between network calls to avoid bursts.
- Diagnostics: Settings page shows nutrition API call count, cache hits, and hit ratio.
If results exist in cache, no network call is made. Clearing browser storage resets the cache.

### Deployment (Vercel)
Build command: `npm run build`
Output directory: `dist`

Steps:
1. Push repo to GitHub.
2. In Vercel, Import Project -> select repo.
3. Set Build Command: `npm run build` and Output: `dist` (Vercel auto-detects Vite usually).
4. (Optional) ENV VARS: add `VITE_NUTRITION_API_KEY` + Firebase config values (these are public anyway) if you prefer not to hardcode.
5. Deploy.

SPA Routing: Vercel serves `index.html` automatically for unknown paths—no extra config needed typically. If needed, add a `vercel.json` with a catch-all rewrite:
```
{
	"rewrites": [ { "source": "/(.*)", "destination": "/index.html" } ]
}
```

After first load the service worker will precache core assets for offline use.

### Clearing / Resetting State
- Local only: clear `localStorage` key starting with `tracker-store` in devtools.
- With cloud sync: disable sync in Settings, then re-enable to re-pull remote.

## Future Ideas
- Macro auto-calculation from ingredients
- More detailed charts (weekly averages, macro distribution pie)
- JSON import/export UI
- Streaks, compliance scoring
- Dark / Light theme toggle
- Conflict resolution UI for cloud merges
- Granular offline caching strategies (runtime nutrition requests)

## License
Personal use only (no redistribution implied).
